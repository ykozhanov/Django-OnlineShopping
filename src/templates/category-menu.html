{% load category_filters %}
<div class="CategoriesButton-content">
    {% with category_list|filter_active as active_category_list %}
        {% for category in active_category_list %}
            {%  if category.parent is None %}
                <div class="CategoriesButton-link">
                    <a href="#{{ category.pk }}">
                        <div class="CategoriesButton-icon">
                            {% with "/media/"|add:category.icon.name as icon_path %}
                                <img src="{{ icon_path }}" alt="{{ category.name }}" />
                            {% endwith %}
                        </div>
                        <span class="CategoriesButton-text">{{ category.name }}</span>
                    </a>
                    {% with active_category_list|filter_children:category as active_child_category_list %}
                        {% for category_sub in active_child_category_list %}
                            {% if forloop.first %}
                                <a class="CategoriesButton-arrow" href="#"></a>
                                <div class="CategoriesButton-submenu" style="display: none;">
                            {% endif %}
                                <a class="CategoriesButton-link" href="#{{ category_sub.pk }}">
                                    <div class="CategoriesButton-icon">
                                        {% with "/media/"|add:category_sub.icon.name as icon_path %}
                                            <img src="{{ icon_path }}" alt="{{ category_sub.name }}" />
                                        {% endwith %}
                                    </div><span class="CategoriesButton-text">{{ category_sub.name }}</span>
                                </a>
                            {% if forloop.last %}
                                </div>
                            {% endif %}
                        {% endfor %}

                    {% endwith %}
                </div>
            {% endif %}
        {% endfor %}
    {% endwith %}
</div>
